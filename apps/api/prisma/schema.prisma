// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum EvidenceStatus {
  PENDING
  PROCESSING
  DONE
  FAILED
}

enum ArtifactType {
  FILE
  DIRECTORY
}

model Evidence {
  id           String   @id @default(uuid())
  evidenceId   String   @unique
  url          String
  timestamp    BigInt
  zipS3Key     String   // S3 key for the ZIP package
  zipHash      String   // SHA-256 hash of the ZIP file
  zipSize      BigInt   // Size of the ZIP file in bytes
  status       EvidenceStatus @default(PENDING)
  artifacts    EvidenceArtifact[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([evidenceId])
  @@index([status])
  @@index([createdAt])
  @@map("evidence")
}

model EvidenceArtifact {
  id          String   @id @default(uuid())
  evidenceId  String
  evidence    Evidence @relation(fields: [evidenceId], references: [id], onDelete: Cascade)
  parentId    String?
  parent      EvidenceArtifact? @relation("ArtifactHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    EvidenceArtifact[] @relation("ArtifactHierarchy")
  path        String   // Full path within ZIP: "screenshot-full.png"
  name        String   // File name: "screenshot-full.png"
  type        ArtifactType
  hash        String   // SHA-256 hash of the file (for verification against ZIP manifest)
  size        BigInt   // Size of the file in bytes
  mimeType    String?  // MIME type of the file
  createdAt   DateTime @default(now())

  @@index([evidenceId])
  @@index([parentId])
  @@index([evidenceId, path])
  @@unique([evidenceId, path])
  @@map("evidence_artifact")
}
